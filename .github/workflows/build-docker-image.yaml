name: Build Docker Image

on:
  push:
    branches: [ dev-ros2 ]
    paths:
      - '.github/workflows/build-docker-image.yaml'
      - '**'
      - '!docker/home/**'
      - '!docker/*.sh'
      - '!docker/timezone/**'
      - '!docker/uid/**'

jobs:

  build-people:
    uses: cmu-cabot/cabot/.github/workflows/build-and-push.yaml@dev-ros2
    with:
      prebuild-name: cuda
      build-name: people
      push-name: people
      tag-name: ros2-latest
    secrets:
      dockerhub-token: ${{ secrets.DOCKERHUB_TOKEN }}

  build-ros2:
    uses: cmu-cabot/cabot/.github/workflows/build-and-push.yaml@dev-ros2
    with:
      prebuild-name: ros2
      build-name: ros2
      push-name: ros2
      tag-name: ros2-latest
    secrets:
      dockerhub-token: ${{ secrets.DOCKERHUB_TOKEN }}

  build-localization:
    uses: cmu-cabot/cabot/.github/workflows/build-and-push.yaml@dev-ros2
    with:
      prebuild-name: ros2
      build-name: localization
      push-name: localization
      tag-name: ros2-latest
    secrets:
      dockerhub-token: ${{ secrets.DOCKERHUB_TOKEN }}

  build-localization:
    uses: cmu-cabot/cabot/.github/workflows/build-and-push.yaml@dev-ros2
    with:
      prebuild-name: ros2
      build-name: gnss
      push-name: gnss
      tag-name: ros2-latest
    secrets:
      dockerhub-token: ${{ secrets.DOCKERHUB_TOKEN }}

  build-people-nuc:
    uses: cmu-cabot/cabot/.github/workflows/build-and-push.yaml@dev-ros2
    with:
      prebuild-name: ros2
      build-name: people-nuc
      push-name: people-nuc
      tag-name: ros2-latest
    secrets:
      dockerhub-token: ${{ secrets.DOCKERHUB_TOKEN }}

  build-ble-scan:
    uses: cmu-cabot/cabot/.github/workflows/build-and-push.yaml@dev-ros2
    with:
      prebuild-name: ros2
      build-name: wireless
      push-name: ble_scan
      tag-name: ros2-latest
    secrets:
      dockerhub-token: ${{ secrets.DOCKERHUB_TOKEN }}
